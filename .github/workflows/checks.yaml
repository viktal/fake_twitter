name: Linux builds
on: [pull_request, push]

jobs:
  clang-format:
    name: Run clang-format
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2.0.0
      - name: Install clang-format
        run:  sudo apt-get update && sudo apt-get install -y clang-format-9
      - name: clang-format
        run:  |
          wget https://raw.githubusercontent.com/Sarcasm/run-clang-format/master/run-clang-format.py
          sudo chmod a+x run-clang-format.py
          ./run-clang-format.py -r --exclude third_party tests fake_twitter
  cpplint:
    name: Run cpplint
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2.0.0
      - name: Install cpplint
        run:  |
          sudo apt-get update
          sudo apt-get install -y python3-pip
          pip3 install cpplint
      - name: cpplint
        run: python3 -m cpplint --linelength=120 --exclude=third_party --exclude=*build* \
          --filter=-legal,-readability/casting  \
          $( find . -name *.h -or -name *.c -or -name *.cpp) || true
